<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure System v10.3 (Backup + Dash)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- 1. VARIAVEIS & TEMA --- */
        :root { --primary: #00a79d; --bg: #f4f6f8; --sidebar: #262626; --card: #ffffff; --text: #333; --border: #e0e0e0; --hover: #f5f5f5; }
        body.dark-mode { --bg: #121212; --sidebar: #000000; --card: #1e1e1e; --text: #e0e0e0; --border: #333; --hover: #2a2a2a; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; transition: background 0.2s, color 0.2s; }
        body { height: 100vh; display: flex; background: var(--bg); color: var(--text); overflow: hidden; }

        /* --- 2. SIDEBAR --- */
        .sidebar { width: 260px; background: var(--sidebar); color: #aaa; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { height: 60px; background: var(--primary); color: white; display: flex; align-items: center; padding: 0 20px; font-weight: bold; letter-spacing: 1px; }
        .menu-scroll { flex: 1; overflow-y: auto; padding-top: 10px; }
        .menu-btn { padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; border-left: 4px solid transparent; color:#ccc; font-size:14px; transition:0.2s; }
        .menu-btn:hover { background: rgba(255,255,255,0.05); color: white; }
        .menu-btn.active { border-left-color: var(--primary); background: rgba(255,255,255,0.1); color: white; font-weight: 600; }
        
        .submenu { display: none; background: rgba(0,0,0,0.2); }
        .submenu.open { display: block; animation: slideDown 0.2s; }
        .sub-btn { padding: 10px 20px 10px 50px; font-size: 13px; cursor: pointer; color: #888; display: block; transition:0.2s; }
        .sub-btn:hover { color: white; padding-left: 55px; }
        .sub-btn.active { color: var(--primary); font-weight: bold; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .sidebar-footer { padding: 20px; border-top: 1px solid #333; }

        /* --- 3. MAIN --- */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .topbar { height: 60px; background: var(--card); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; }
        .view { display: none; width:100%; height:100%; overflow-y: auto; animation: fadeIn 0.3s; }
        .view.active { display: block; }
        .container-pad { padding: 30px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* UI */
        .card { background: var(--card); padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid var(--border); }
        .grid-3-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; height: 100%; } 
        
        h2, h3, h4 { color: var(--text); margin-bottom: 15px; font-weight: 600; }
        input, select { width: 100%; padding: 10px; background: var(--bg); color: var(--text); border: 1px solid var(--border); border-radius: 4px; outline: none; margin-bottom: 10px; }
        input:focus, select:focus { border-color: var(--primary); }
        label { display: block; font-size: 11px; font-weight: bold; color: #888; margin-bottom: 5px; text-transform: uppercase; }

        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; transition:0.2s; display:inline-flex; align-items:center; gap:5px; justify-content:center; }
        .btn:hover { filter: brightness(0.9); transform: translateY(-1px); }
        .btn-primary { background: var(--primary); }
        .btn-danger { background: #ef4444; }
        .btn-dark { background: #333; }
        .btn-sm { padding: 5px 10px; font-size: 11px; }

        /* LISTS */
        .list-group { list-style: none; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; background: var(--card); }
        .list-item { padding: 12px 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition:0.2s; }
        .list-item:last-child { border-bottom: none; }
        .list-item:hover { background: var(--hover); padding-left:18px; }
        .list-item.active { background: rgba(0, 167, 157, 0.1); border-left: 4px solid var(--primary); color: var(--primary); font-weight: bold; }

        .rename-inp { border: none; border-bottom: 1px dashed #999; background: transparent; width: 100%; padding: 2px; color: var(--text); }
        .rename-inp:focus { outline: none; border-bottom: 2px solid var(--primary); }

        /* CCTV CARD STYLE */
        .cctv-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; padding-bottom: 50px; }
        .cctv-card { background: #000; border: 2px solid #444; border-radius: 4px; aspect-ratio: 16/9; position: relative; overflow: hidden; transition: border-color 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .cctv-card.st-ok { border-color: #10b981; }
        .cctv-card.st-erro { border-color: #ef4444; animation: pulseBorder 1.5s infinite; }
        .cctv-card.st-pendente { border-color: #555; }
        @keyframes pulseBorder { 0% { border-color: #ef4444; } 50% { border-color: #500; } 100% { border-color: #ef4444; } }
        
        .cctv-feed { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .cctv-noise { width: 100%; height: 100%; background: repeating-linear-gradient(45deg, #111 0px, #111 2px, #222 2px, #222 4px); display: flex; align-items: center; justify-content: center; color: #555; flex-direction: column; font-size:12px; }
        
        .cctv-hud { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.85); padding: 5px 8px; display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(2px); }
        .cctv-name { color: white; font-family: monospace; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 50%; }
        .cctv-select { background: #333; color: white; border: 1px solid #555; padding: 2px; border-radius: 3px; font-size: 10px; outline: none; cursor: pointer; width:auto; margin:0; height: 20px; }
        
        .rec-dot { position: absolute; top: 10px; right: 10px; color: #10b981; font-weight: bold; font-size:10px; animation: blink 1s infinite; display: none; font-family: monospace; text-shadow: 0 0 5px #10b981; }
        .st-ok .rec-dot { display: block; content: "‚óè REC"; }
        @keyframes blink { 50% { opacity: 0; } }

        /* CHECKLIST COMPACT INPUTS */
        .compact-bar { display: flex; gap: 10px; align-items: flex-end; background: var(--bg); padding: 10px; border-radius: 6px; border: 1px solid var(--border); }
        .compact-group { flex: 1; }
        .compact-input { width: 100%; padding: 6px 10px; height: 35px; font-size: 13px; margin-bottom: 0; background: var(--card); }
        .compact-btn { height: 35px; padding: 0 20px; margin: 0; display: flex; align-items: center; justify-content: center; }

        /* TREE VIEW */
        .tree-box { border: 1px solid var(--border); border-radius: 4px; background: var(--bg); max-height: 400px; overflow-y: auto; padding: 15px; }
        .tree-type { margin-bottom: 10px; border: 1px solid var(--border); border-radius: 4px; background: var(--card); overflow: hidden; }
        .tree-type-header { display: flex; align-items: center; padding: 10px; cursor: pointer; background: var(--card); transition: 0.2s; }
        .tree-type-header:hover { background: #f9f9f9; }
        .tree-chevron { margin-right: 10px; font-size: 12px; color: #888; transition: transform 0.2s; }
        .tree-type.closed .tree-chevron { transform: rotate(-90deg); }
        .tree-type-header input { width: auto; margin: 0 10px 0 0; transform: scale(1.3); cursor: pointer; }
        .tree-type-label { flex: 1; font-size: 14px; font-weight: bold; color: var(--primary); }
        .tree-group-list { padding: 5px 10px 10px 35px; border-top: 1px solid #eee; }
        .tree-type.closed .tree-group-list { display: none; } 
        .tree-group-item { display: flex; align-items: center; padding: 5px 0; }
        .tree-group-item input { width: auto; margin: 0 10px 0 0; cursor: pointer; transform: scale(1.1); }
        .tree-group-item label { margin: 0; font-weight: normal; font-size: 13px; cursor: pointer; color: var(--text); }

        /* REPORT TABLE & KPI */
        .rep-kpi { text-align: center; padding: 20px; background: var(--card); border: 1px solid var(--border); border-radius: 8px; }
        .rep-val { font-size: 28px; font-weight: 800; color: var(--primary); }
        .rep-lbl { font-size: 11px; text-transform: uppercase; color: #888; margin-top: 5px; }
        .rep-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .rep-table th { text-align: left; padding: 12px; background: rgba(0,0,0,0.03); border-bottom: 2px solid var(--border); color: var(--text); text-transform: uppercase; font-size: 11px; }
        .rep-table td { padding: 12px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 11px; text-transform: uppercase; }
        .bg-ok { background: #d1fae5; color: #065f46; } .bg-err { background: #fee2e2; color: #991b1b; } .bg-pen { background: #f3f4f6; color: #666; }

        /* MODAL FOTO */
        .modal-mask { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000; justify-content: center; align-items: center; }
        .modal-img-content { max-width: 95%; max-height: 90vh; border: 2px solid white; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

        /* LOGIN & HERO */
        #login-screen { position: fixed; inset: 0; background: var(--sidebar); z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: var(--card); padding: 40px; width: 350px; border-radius: 8px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .hero { width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1497366216548-37526070297c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80') center/cover; position: relative; }
        .hero-overlay { position: absolute; inset: 0; background: linear-gradient(135deg, rgba(0, 167, 157, 0.9), rgba(30, 200, 180, 0.6)); display: flex; flex-direction: column; justify-content: center; padding-left: 60px; color: white; }

        /* PRINT */
        @media print {
            .sidebar, .topbar, .no-print { display: none !important; }
            .main { overflow: visible; height: auto; }
            .view { padding: 0; overflow: visible; }
            body { background: white; color: black; height: auto; }
            .card { box-shadow: none; border: none; padding: 0; margin-bottom: 10px; }
            .print-header { display: block !important; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
            .print-footer { display: flex !important; margin-top: 50px; justify-content: space-between; }
            .sign-box { width: 45%; border-top: 1px solid #000; text-align: center; padding-top: 10px; font-size: 12px; }
        }
        .print-header, .print-footer { display: none; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <div style="font-size:40px; color:var(--primary); margin-bottom:10px"><i class="fas fa-shield-alt"></i></div>
            <h2 style="margin-bottom:20px; border:none">Acesso Admin</h2>
            <input id="login-user" placeholder="admin">
            <input type="password" id="login-pass" placeholder="123">
            <button class="btn btn-primary" style="width:100%" onclick="Auth.login()">ENTRAR</button>
        </div>
    </div>

    <input type="file" id="hidden-photo-input" accept="image/*" style="display:none" onchange="AdmInst.processPhoto(this)">
    <div id="modal-photo" class="modal-mask" onclick="this.style.display='none'">
        <img id="modal-img-tag" class="modal-img-content" src="">
    </div>

    <nav class="sidebar">
        <div class="sidebar-header"><i class="fas fa-shield-alt"></i> SECURE SYS v10.3</div>
        <div class="menu-scroll">
            <div class="menu-btn active" onclick="Nav.go('hero')"><i class="fas fa-home"></i> In√≠cio</div>
            
            <div class="menu-btn" onclick="Nav.toggleSub('sub-admin')">
                <i class="fas fa-cogs"></i> Administra√ß√£o <i class="fas fa-chevron-down" style="margin-left:auto; font-size:10px"></i>
            </div>
            <div id="sub-admin" class="submenu">
                <div class="sub-btn" onclick="Nav.go('admin-sites')">1. Sites (Locais)</div>
                <div class="sub-btn" onclick="Nav.go('admin-types')">2. Cat√°logo Tipos</div>
                <div class="sub-btn" onclick="Nav.go('admin-equips')">3. Instala√ß√£o</div>
            </div>

            <div class="menu-btn" onclick="Nav.go('checklist-cctv')"><i class="fas fa-video"></i> Checklist CCTV</div>
            <div class="menu-btn" onclick="Nav.go('checklist-eq')"><i class="fas fa-tasks"></i> Checklist Equip.</div>
            
            <div class="menu-btn" onclick="Nav.go('os')"><i class="fas fa-tools"></i> Manuten√ß√£o</div>
            <div class="menu-btn" onclick="Nav.go('reports')"><i class="fas fa-file-alt"></i> Relat√≥rios</div>
        </div>
        
        <div class="sidebar-footer">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-bottom:10px">
                <button class="btn btn-dark btn-sm" onclick="DB.export()"><i class="fas fa-download"></i> Backup</button>
                <label class="btn btn-dark btn-sm" style="margin:0; cursor:pointer; text-align:center">
                    <i class="fas fa-upload"></i> Restaurar
                    <input type="file" style="display:none" onchange="DB.import(this)" accept=".json">
                </label>
            </div>
            <button class="btn btn-danger" style="width:100%; font-size:11px" onclick="DB.reset()"><i class="fas fa-trash"></i> RESETAR TUDO</button>
        </div>
    </nav>

    <main class="main">
        <div class="topbar">
            <h3><i class="fas fa-user-circle"></i> Bem-vindo</h3>
            <button class="btn btn-dark" onclick="App.toggleTheme()"><i class="fas fa-adjust"></i> Tema</button>
        </div>

        <div id="view-hero" class="view active" style="padding:0">
            <div class="hero">
                <div class="hero-overlay">
                    <h1 style="font-size:48px; font-weight:800; margin-bottom:10px">Sistema Integrado</h1>
                    <p style="font-size:22px; opacity:0.9">Gest√£o de Ativos e Seguran√ßa</p>
                    
                    <div style="margin-top:30px; display:flex; gap:20px">
                        <div class="card" style="background:rgba(0,0,0,0.6); color:white; border:1px solid rgba(255,255,255,0.2); min-width:150px; text-align:center">
                            <div style="font-size:30px; font-weight:bold" id="dash-total">0</div>
                            <div style="font-size:12px; opacity:0.8">ITENS HOJE</div>
                        </div>
                        <div class="card" style="background:rgba(239, 68, 68, 0.6); color:white; border:1px solid rgba(255,255,255,0.2); min-width:150px; text-align:center">
                            <div style="font-size:30px; font-weight:bold" id="dash-fail">0</div>
                            <div style="font-size:12px; opacity:0.8">FALHAS HOJE</div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div id="view-admin-sites" class="view container-pad">
            <div class="card">
                <h2 style="color:var(--primary)">1. Gerenciar Sites</h2>
                <div style="display:flex; gap:10px; margin-bottom:20px">
                    <input id="site-name" placeholder="Nome do Local (ex: Unidade Centro)" style="margin:0">
                    <button class="btn btn-primary" onclick="AdmSites.add()">Adicionar</button>
                </div>
                <ul id="site-list" class="list-group"></ul>
            </div>
        </div>

        <div id="view-admin-types" class="view container-pad">
            <div class="card">
                <h2 style="color:var(--primary)">2. Cat√°logo de Tipos</h2>
                <div style="display:flex; gap:10px; margin-bottom:20px">
                    <div style="flex:2">
                        <label>Nome do Dispositivo</label>
                        <input id="type-name" placeholder="Ex: C√¢mera IP, Catraca" style="margin:0">
                    </div>
                    <div style="flex:1">
                        <label>Categoria</label>
                        <select id="type-cat" style="margin:0">
                            <option value="video">V√≠deo / C√¢mera</option>
                            <option value="other">Outros</option>
                        </select>
                    </div>
                    <div style="display:flex; align-items:flex-end">
                        <button class="btn btn-primary" onclick="AdmTypes.add()">Adicionar</button>
                    </div>
                </div>
                <label>Cat√°logo Global</label>
                <ul id="type-list" class="list-group"></ul>
            </div>
        </div>

        <div id="view-admin-equips" class="view container-pad">
            <h2 style="margin-bottom:20px; color:var(--primary)">3. Instala√ß√£o</h2>
            <div class="card" style="border-left: 5px solid var(--primary)">
                <label>PASSO 1: Selecione o Local</label>
                <select id="eq-site-select" onchange="AdmInst.onSiteChange()" style="margin:0"></select>
            </div>
            <div id="eq-panel" style="display:none; height: calc(100vh - 250px);">
                <div class="grid-3-col">
                    <div class="card" style="display:flex; flex-direction:column">
                        <h4>PASSO 2: O Que?</h4>
                        <ul id="catalog-list" class="list-group" style="flex:1; overflow-y:auto"></ul>
                    </div>
                    <div class="card" style="display:flex; flex-direction:column; border-color:var(--primary)">
                        <h4 id="group-col-title">PASSO 3: Configurar</h4>
                        <div id="create-group-form" style="display:none; background:rgba(0, 167, 157, 0.05); padding:15px; border-radius:6px; margin-bottom:15px; border:1px dashed var(--primary)">
                            <label style="color:var(--primary)">Novo Grupo</label>
                            <input id="group-name-in" placeholder="Nome (Ex: C√¢meras Hall)">
                            <label>Quantidade Inicial</label>
                            <div style="display:flex; gap:5px">
                                <input type="number" id="group-qty-in" value="1" min="1">
                                <button class="btn btn-primary" onclick="AdmInst.createGroup()">Criar</button>
                            </div>
                        </div>
                        <label>Grupos Existentes</label>
                        <ul id="group-list" class="list-group" style="flex:1; overflow-y:auto"></ul>
                    </div>
                    <div class="card" style="display:flex; flex-direction:column">
                        <h4>PASSO 4: Itens e Fotos</h4>
                        <div id="item-msg" style="text-align:center; color:#888; margin-top:50px"><i class="fas fa-arrow-left"></i> Selecione um grupo</div>
                        <div id="item-list-box" style="display:none; flex:1; display:flex; flex-direction:column">
                            <div style="display:flex; justify-content:space-between; margin-bottom:10px">
                                <small>Renomeie e anexe fotos:</small>
                                <button class="btn btn-sm btn-primary" onclick="AdmInst.addOneMore()">+1 Item</button>
                            </div>
                            <ul id="item-list" class="list-group" style="flex:1; overflow-y:auto"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-checklist-cctv" class="view container-pad">
            <div class="card no-print" style="padding:15px">
                <h2 style="margin-bottom:15px; font-size:18px"><i class="fas fa-video"></i> Checklist CCTV</h2>
                <div class="compact-bar">
                    <div class="compact-group"><label>Data</label><input type="date" id="cctv-date" class="compact-input" onchange="ChecklistCCTV.clear()"></div>
                    <div class="compact-group"><label>Site</label><select id="cctv-site" class="compact-input" onchange="ChecklistCCTV.onSiteChange()"></select></div>
                    <div class="compact-group"><label>Equipamento</label><select id="cctv-type" class="compact-input" disabled onchange="ChecklistCCTV.onTypeChange()"></select></div>
                    <div class="compact-group"><label>Grupo</label><select id="cctv-group" class="compact-input" disabled></select></div>
                    <button class="btn btn-primary compact-btn" onclick="ChecklistCCTV.load()"><i class="fas fa-power-off"></i> Carregar</button>
                </div>
            </div>
            <div id="cctv-container" style="padding-bottom:50px"></div>
        </div>

        <div id="view-checklist-eq" class="view container-pad">
            <div class="card no-print" style="padding:15px">
                <h2 style="margin-bottom:15px; font-size:18px"><i class="fas fa-tasks"></i> Checklist Equipamentos</h2>
                <div class="compact-bar">
                    <div class="compact-group"><label>Data</label><input type="date" id="eq-date" class="compact-input" onchange="ChecklistEq.clear()"></div>
                    <div class="compact-group"><label>Site</label><select id="eq-site" class="compact-input" onchange="ChecklistEq.onSiteChange()"></select></div>
                    <div class="compact-group"><label>Equipamento</label><select id="eq-type" class="compact-input" disabled onchange="ChecklistEq.onTypeChange()"></select></div>
                    <div class="compact-group"><label>Grupo</label><select id="eq-group" class="compact-input" disabled></select></div>
                    <button class="btn btn-primary compact-btn" onclick="ChecklistEq.load()"><i class="fas fa-search"></i> Carregar</button>
                </div>
            </div>
            <div id="eq-container" style="padding-bottom:50px"></div>
        </div>

        <div id="view-os" class="view container-pad"><div class="card"><h2>Manuten√ß√£o</h2><p>M√≥dulo de O.S. mantido.</p></div></div>

        <div id="view-reports" class="view container-pad">
            <div class="print-header">
                <h2 style="text-align:center; border:none; margin-bottom:5px">RELAT√ìRIO T√âCNICO DE SEGURAN√áA</h2>
                <div style="text-align:center; font-size:12px; color:#555" id="print-date-info"></div>
            </div>
            <div class="card no-print">
                <h2 style="color:var(--primary)"><i class="fas fa-filter"></i> Configura√ß√£o do Relat√≥rio</h2>
                <div class="grid-2" style="margin-bottom:20px">
                    <div><label>Data da Inspe√ß√£o</label><input type="date" id="rep-date"></div>
                    <div><label>Local (Site)</label><select id="rep-site" onchange="Reports.onSiteChange()"></select></div>
                </div>
                
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px">
                    <label style="color:var(--text); margin:0">Selecione os Itens para o Relat√≥rio:</label>
                    <div style="gap:5px; display:flex">
                         <button class="btn btn-sm btn-dark" onclick="Reports.toggleAllTree(true)">Expandir Tudo</button>
                         <button class="btn btn-sm btn-dark" onclick="Reports.toggleAllTree(false)">Recolher Tudo</button>
                    </div>
                </div>
                
                <div id="rep-tree-view" class="tree-box">
                    <div style="padding:20px; text-align:center; color:#888">Selecione um local acima para carregar os itens.</div>
                </div>

                <button class="btn btn-primary" style="width:100%; margin-top:15px" onclick="Reports.generate()"><i class="fas fa-file-alt"></i> Gerar Relat√≥rio Detalhado</button>
            </div>
            
            <div id="rep-results" style="display:none">
                <div class="grid-3-col" style="height:auto; margin-bottom:20px">
                    <div class="rep-kpi"><div class="rep-val" id="kpi-total">0</div><div class="rep-lbl">Total Verificado</div></div>
                    <div class="rep-kpi"><div class="rep-val" style="color:#ef4444" id="kpi-fail">0</div><div class="rep-lbl">Itens com Falha</div></div>
                    <div class="rep-kpi"><div class="rep-val" style="color:#10b981" id="kpi-ok">0%</div><div class="rep-lbl">Operacionalidade</div></div>
                </div>
                <div class="card">
                    <h4 style="color:var(--text)">Detalhamento</h4>
                    <table class="rep-table">
                        <thead><tr><th>Equipamento / Local</th><th>Status</th><th>Observa√ß√£o</th></tr></thead>
                        <tbody id="rep-table-body"></tbody>
                    </table>
                </div>
                <div class="no-print" style="text-align:right; margin-top:20px"><button class="btn btn-dark" onclick="window.print()"><i class="fas fa-print"></i> Imprimir / PDF</button></div>
                <div class="print-footer">
                    <div class="sign-box">_____________________________<br>T√©cnico Respons√°vel</div>
                    <div class="sign-box">_____________________________<br>Supervisor / Cliente</div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- DB ---
        const DB = {
            data: { sites: [], types: [], groups: [], equips: [], checks: [] },
            init: () => { const s=localStorage.getItem('sys_v103'); if(s) DB.data=JSON.parse(s); else DB.seed(); },
            save: () => localStorage.setItem('sys_v103', JSON.stringify(DB.data)),
            seed: () => {
                DB.data.sites=[{id:1, name:'Matriz SP'}];
                DB.data.types=[{id:10, name:'C√¢mera IP', isVideo:true}, {id:20, name:'Catraca', isVideo:false}];
                DB.save();
            },
            reset: () => { localStorage.removeItem('sys_v103'); location.reload(); },
            export: () => { const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(DB.data)],{type:'application/json'})); a.download='backup.json'; a.click(); },
            import: (inp) => { const fr=new FileReader(); fr.onload=(e)=>{ if(confirm("Restaurar backup? Isso apagar√° os dados atuais.")){ DB.data=JSON.parse(e.target.result); DB.save(); location.reload(); }}; fr.readAsText(inp.files[0]); }
        };

        // --- ADMIN MODULES ---
        const AdmSites={render:()=>{document.getElementById('site-list').innerHTML=DB.data.sites.map(s=>`<li class="list-item"><b>${s.name}</b><button class="btn btn-sm btn-danger" onclick="AdmSites.del(${s.id})"><i class="fas fa-trash"></i></button></li>`).join('')},add:()=>{const n=document.getElementById('site-name').value;if(n){DB.data.sites.push({id:Date.now(),name:n});DB.save();document.getElementById('site-name').value='';AdmSites.render()}},del:(id)=>{if(confirm('Del?')){DB.data.sites=DB.data.sites.filter(x=>x.id!==id);DB.save();AdmSites.render()}}};
        const AdmTypes={render:()=>{document.getElementById('type-list').innerHTML=DB.data.types.map(t=>`<li class="list-item"><span>${t.isVideo?'üì∑':''} ${t.name}</span><button class="btn btn-sm btn-danger" onclick="AdmTypes.del(${t.id})"><i class="fas fa-trash"></i></button></li>`).join('')},add:()=>{const n=document.getElementById('type-name').value;const c=document.getElementById('type-cat').value;if(n){DB.data.types.push({id:Date.now(),name:n,isVideo:c==='video'});DB.save();document.getElementById('type-name').value='';AdmTypes.render()}},del:(id)=>{if(confirm('Del?')){DB.data.types=DB.data.types.filter(x=>x.id!==id);DB.save();AdmTypes.render()}}};
        const AdmInst={currSite:null,currTypeId:null,currGroup:null,uploadItemId:null,init:()=>{document.getElementById('eq-site-select').innerHTML='<option value="">Selecione...</option>'+DB.data.sites.map(s=>`<option value="${s.id}">${s.name}</option>`).join('');document.getElementById('eq-panel').style.display='none'},onSiteChange:()=>{const v=document.getElementById('eq-site-select').value;if(!v){document.getElementById('eq-panel').style.display='none';return}AdmInst.currSite=parseInt(v);document.getElementById('eq-panel').style.display='block';document.getElementById('catalog-list').innerHTML=DB.data.types.map(t=>`<li class="list-item" onclick="AdmInst.selectType(${t.id})"><span>${t.name}</span> <i class="fas fa-chevron-right"></i></li>`).join('');AdmInst.renderGroups();document.getElementById('create-group-form').style.display='none';document.getElementById('item-list-box').style.display='none';document.getElementById('item-msg').style.display='block'},selectType:(tid)=>{AdmInst.currTypeId=tid;AdmInst.currGroup=null;const t=DB.data.types.find(x=>x.id===tid);Array.from(document.querySelectorAll('#catalog-list .list-item')).forEach(el=>el.classList.remove('active'));event.currentTarget.classList.add('active');document.getElementById('group-col-title').innerText=`PASSO 3: ${t.name}`;document.getElementById('create-group-form').style.display='block';document.getElementById('group-name-in').value=t.name;AdmInst.renderGroups();document.getElementById('item-list-box').style.display='none';document.getElementById('item-msg').style.display='block'},createGroup:()=>{const name=document.getElementById('group-name-in').value;const qty=parseInt(document.getElementById('group-qty-in').value);if(name&&qty>0){const gid=Date.now();DB.data.groups.push({id:gid,siteId:AdmInst.currSite,typeId:AdmInst.currTypeId,name:name});for(let i=0;i<qty;i++){let num=i+1;DB.data.equips.push({id:Date.now()+i,groupId:gid,siteId:AdmInst.currSite,name:`${name} ${num<10?'0'+num:num}`,image:null})}DB.save();AdmInst.renderGroups();AdmInst.selectGroup(gid)}},renderGroups:()=>{const groups=DB.data.groups.filter(g=>g.siteId===AdmInst.currSite&&g.typeId===AdmInst.currTypeId);document.getElementById('group-list').innerHTML=groups.map(g=>{const count=DB.data.equips.filter(e=>e.groupId===g.id).length;return `<li class="list-item ${AdmInst.currGroup===g.id?'active':''}" onclick="AdmInst.selectGroup(${g.id})"><span>${g.name}</span> <span class="btn-sm btn-dark">${count}</span></li>`}).join('')},selectGroup:(gid)=>{AdmInst.currGroup=gid;AdmInst.renderGroups();document.getElementById('item-msg').style.display='none';document.getElementById('item-list-box').style.display='flex';AdmInst.renderItems()},addOneMore:()=>{if(!AdmInst.currGroup)return;const grp=DB.data.groups.find(g=>g.id===AdmInst.currGroup);const count=DB.data.equips.filter(e=>e.groupId===AdmInst.currGroup).length+1;DB.data.equips.push({id:Date.now(),groupId:AdmInst.currGroup,siteId:AdmInst.currSite,name:`${grp.name} ${count<10?'0'+count:count}`,image:null});DB.save();AdmInst.renderItems();AdmInst.renderGroups()},renderItems:()=>{const items=DB.data.equips.filter(e=>e.groupId===AdmInst.currGroup);document.getElementById('item-list').innerHTML=items.map(e=>{const hasImg=e.image?'color:var(--primary)':'color:#ccc';return `<li class="list-item"><input class="rename-inp" value="${e.name}" onchange="AdmInst.rename(${e.id},this.value)"><div style="display:flex; gap:5px"><button class="btn btn-sm" style="background:transparent; ${hasImg}; font-size:16px" onclick="AdmInst.triggerUpload(${e.id})"><i class="fas fa-camera"></i></button><button class="btn btn-sm btn-danger" tabindex="-1" onclick="AdmInst.delItem(${e.id})"><i class="fas fa-trash"></i></button></div></li>`}).join('')},rename:(id,v)=>{const e=DB.data.equips.find(x=>x.id===id);if(e){e.name=v;DB.save()}},delItem:(id)=>{if(confirm('Del?')){DB.data.equips=DB.data.equips.filter(x=>x.id!==id);DB.save();AdmInst.renderItems();AdmInst.renderGroups()}},triggerUpload:(id)=>{AdmInst.uploadItemId=id;document.getElementById('hidden-photo-input').click()},processPhoto:(input)=>{if(input.files&&input.files[0]){const reader=new FileReader();reader.onload=function(e){const img=new Image();img.src=e.target.result;img.onload=function(){const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');const MAX_WIDTH=800;const scale=MAX_WIDTH/img.width;canvas.width=MAX_WIDTH;canvas.height=img.height*scale;ctx.drawImage(img,0,0,canvas.width,canvas.height);const compressedData=canvas.toDataURL('image/jpeg',0.7);const item=DB.data.equips.find(x=>x.id===AdmInst.uploadItemId);if(item){item.image=compressedData;DB.save();AdmInst.renderItems()}}};reader.readAsDataURL(input.files[0])}}};

        // --- CHECKLIST CCTV (VIDEO ONLY) ---
        const ChecklistCCTV = {
            init: () => { document.getElementById('cctv-date').valueAsDate=new Date(); document.getElementById('cctv-site').innerHTML='<option value="">Selecione...</option>'+DB.data.sites.map(s=>`<option value="${s.id}">${s.name}</option>`).join('') },
            clear: () => { document.getElementById('cctv-container').innerHTML='' },
            onSiteChange: () => {
                const sid=parseInt(document.getElementById('cctv-site').value); const typeSel=document.getElementById('cctv-type');
                if(!sid){typeSel.innerHTML='';typeSel.disabled=true;return}
                const groups=DB.data.groups.filter(g=>g.siteId===sid); const typeIds=[...new Set(groups.map(g=>g.typeId))];
                const types=DB.data.types.filter(t=>t.isVideo && typeIds.includes(t.id)); 
                typeSel.innerHTML='<option value="">Selecione...</option>'+types.map(t=>`<option value="${t.id}">${t.name}</option>`).join(''); typeSel.disabled=false;
                ChecklistCCTV.clear();
            },
            onTypeChange: () => {
                const sid=parseInt(document.getElementById('cctv-site').value); const tid=parseInt(document.getElementById('cctv-type').value); const grpSel=document.getElementById('cctv-group');
                if(!tid){grpSel.innerHTML='';grpSel.disabled=true;return}
                const groups=DB.data.groups.filter(g=>g.siteId===sid && g.typeId===tid);
                grpSel.innerHTML='<option value="">Selecione...</option>'+groups.map(g=>`<option value="${g.id}">${g.name}</option>`).join(''); grpSel.disabled=false;
            },
            load: () => {
                const gid=parseInt(document.getElementById('cctv-group').value); const date=document.getElementById('cctv-date').value;
                if(!gid)return alert('Selecione um grupo');
                const items=DB.data.equips.filter(e=>e.groupId===gid);
                const container=document.getElementById('cctv-container');
                if(items.length===0)return container.innerHTML='<p style="text-align:center;padding:20px">Vazio</p>';
                container.className="cctv-grid";
                container.innerHTML=items.map(i=>{
                    const check=DB.data.checks.find(c=>c.date===date && c.equipId===i.id);
                    const st=check?check.status:'Pendente';
                    let content=i.image?`<img src="${i.image}" class="cctv-feed" onclick="document.getElementById('modal-img-tag').src='${i.image}';document.getElementById('modal-photo').style.display='flex'">`:`<div class="cctv-noise">NO SIGNAL</div>`;
                    return `<div class="cctv-card st-${st.toLowerCase()}"><div class="rec-dot">‚óè REC</div>${content}<div class="cctv-hud"><div class="cctv-name">${i.name}</div><select class="cctv-select" onchange="ChecklistCCTV.save(${i.id},this.value)"><option ${st=='Pendente'?'selected':''}>Pendente</option><option ${st=='OK'?'selected':''}>OK</option><option ${st=='Erro'?'selected':''}>Erro</option></select></div></div>`;
                }).join('');
            },
            save: (id,st)=>{ const date=document.getElementById('cctv-date').value; DB.data.checks=DB.data.checks.filter(c=>!(c.date===date && c.equipId===id)); DB.data.checks.push({date,equipId:id,status:st}); DB.save(); ChecklistCCTV.load(); App.updateDash(); }
        };

        // --- CHECKLIST EQUIPS (NON-VIDEO) - EDITED FOR VISUAL FEEDBACK ---
        const ChecklistEq = {
            init: () => { document.getElementById('eq-date').valueAsDate=new Date(); document.getElementById('eq-site').innerHTML='<option value="">Selecione...</option>'+DB.data.sites.map(s=>`<option value="${s.id}">${s.name}</option>`).join('') },
            clear: () => { document.getElementById('eq-container').innerHTML='' },
            onSiteChange: () => {
                const sid=parseInt(document.getElementById('eq-site').value); const typeSel=document.getElementById('eq-type');
                if(!sid){typeSel.innerHTML='';typeSel.disabled=true;return}
                const groups=DB.data.groups.filter(g=>g.siteId===sid); const typeIds=[...new Set(groups.map(g=>g.typeId))];
                const types=DB.data.types.filter(t=>!t.isVideo && typeIds.includes(t.id));
                typeSel.innerHTML='<option value="">Selecione...</option>'+types.map(t=>`<option value="${t.id}">${t.name}</option>`).join(''); typeSel.disabled=false;
                ChecklistEq.clear();
            },
            onTypeChange: () => {
                const sid=parseInt(document.getElementById('eq-site').value); const tid=parseInt(document.getElementById('eq-type').value); const grpSel=document.getElementById('eq-group');
                if(!tid){grpSel.innerHTML='';grpSel.disabled=true;return}
                const groups=DB.data.groups.filter(g=>g.siteId===sid && g.typeId===tid);
                grpSel.innerHTML='<option value="">Selecione...</option>'+groups.map(g=>`<option value="${g.id}">${g.name}</option>`).join(''); grpSel.disabled=false;
            },
            load: () => {
                const gid = parseInt(document.getElementById('eq-group').value);
                const date = document.getElementById('eq-date').value;
                if (!gid) return alert('Selecione um grupo');
                
                const items = DB.data.equips.filter(e => e.groupId === gid);
                const container = document.getElementById('eq-container');
                container.className = "list-group";
                
                if (items.length === 0) return container.innerHTML = '<p style="text-align:center;padding:20px">Vazio</p>';
                
                container.innerHTML = items.map(i => {
                    const check = DB.data.checks.find(c => c.date === date && c.equipId === i.id);
                    const st = check ? check.status : 'Pendente';
                    
                    // Style logic for visual feedback
                    let bgStyle = '';
                    if(st === 'OK') bgStyle = 'background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981;';
                    if(st === 'Erro') bgStyle = 'background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444;';
                    
                    return `
                    <div class="list-item" style="cursor:default; ${bgStyle}">
                        <span style="font-weight:500">${i.name}</span>
                        <select class="cctv-select" style="width:100px; height:30px;" onchange="ChecklistEq.save(${i.id},this.value)">
                            <option ${st == 'Pendente' ? 'selected' : ''}>Pendente</option>
                            <option ${st == 'OK' ? 'selected' : ''}>OK</option>
                            <option ${st == 'Erro' ? 'selected' : ''}>Erro</option>
                        </select>
                    </div>`;
                }).join('');
            },
            save: (id,st)=>{ const date=document.getElementById('eq-date').value; DB.data.checks=DB.data.checks.filter(c=>!(c.date===date && c.equipId===id)); DB.data.checks.push({date,equipId:id,status:st}); DB.save(); ChecklistEq.load(); App.updateDash(); }
        };

        // --- REPORTS (TREE) ---
        const Reports = {
            init: () => { document.getElementById('rep-date').valueAsDate = new Date(); document.getElementById('rep-site').innerHTML = '<option value="">Selecione...</option>' + DB.data.sites.map(s=>`<option value="${s.id}">${s.name}</option>`).join(''); },
            onSiteChange: () => {
                const sid = parseInt(document.getElementById('rep-site').value);
                const tree = document.getElementById('rep-tree-view');
                if(!sid) { tree.innerHTML = '<div style="padding:20px; text-align:center; color:#888">Selecione um local.</div>'; return; }
                let html = '';
                const typesInSite = [...new Set(DB.data.groups.filter(g=>g.siteId===sid).map(g=>g.typeId))];
                typesInSite.forEach(tid => {
                    const typeName = DB.data.types.find(t=>t.id===tid)?.name || 'Desconhecido';
                    const groups = DB.data.groups.filter(g => g.siteId === sid && g.typeId === tid);
                    html += `<div class="tree-type"><div class="tree-type-header" onclick="Reports.toggleTree(this)"><i class="fas fa-chevron-right tree-chevron"></i><input type="checkbox" class="tree-type-check" onchange="Reports.toggleType(this); event.stopPropagation()" checked onclick="event.stopPropagation()"><span class="tree-type-label">${typeName}</span></div><div class="tree-group-list" style="display:none">${groups.map(g => `<div class="tree-group-item"><input type="checkbox" class="tree-group-check" value="${g.id}" checked><label>${g.name}</label></div>`).join('')}</div></div>`;
                });
                tree.innerHTML = html || '<p style="padding:20px">Vazio</p>';
            },
            toggleTree: (h) => { const d=h.parentElement; const l=d.querySelector('.tree-group-list'); const i=d.querySelector('.tree-chevron'); d.classList.toggle('closed'); if(l.style.display==='none'){l.style.display='block';i.style.transform='rotate(90deg)'}else{l.style.display='none';i.style.transform='rotate(0deg)'} },
            toggleType: (cb) => { cb.closest('.tree-type').querySelectorAll('.tree-group-check').forEach(c=>c.checked=cb.checked) },
            toggleAllTree: (st) => { document.querySelectorAll('.tree-type-header').forEach(h=>{ const d=h.parentElement; const l=d.querySelector('.tree-group-list'); const i=d.querySelector('.tree-chevron'); if(st){l.style.display='block';i.style.transform='rotate(90deg)'}else{l.style.display='none';i.style.transform='rotate(0deg)'} }) },
            generate: () => {
                const date = document.getElementById('rep-date').value;
                const selGrps = Array.from(document.querySelectorAll('.tree-group-check:checked')).map(c=>parseInt(c.value));
                if(selGrps.length===0) return alert("Selecione itens");
                
                const items = DB.data.equips.filter(e=>selGrps.includes(e.groupId));
                const itemIds = items.map(e=>e.id);
                const checks = DB.data.checks.filter(c=>c.date===date && itemIds.includes(c.equipId));
                
                const total = checks.length;
                const fails = checks.filter(c=>c.status!=='OK'&&c.status!=='Pendente').length;
                const okPct = total>0 ? Math.round(((total-fails)/total)*100) : 0;
                
                document.getElementById('kpi-total').innerText = total;
                document.getElementById('kpi-fail').innerText = fails;
                document.getElementById('kpi-ok').innerText = okPct+'%';
                
                document.getElementById('rep-table-body').innerHTML = checks.map(c=>{
                    const eq = DB.data.equips.find(e=>e.id===c.equipId);
                    const grp = DB.data.groups.find(g=>g.id===eq.groupId);
                    let badge = c.status==='OK'?'bg-ok':'bg-err';
                    if(c.status==='Pendente') badge='bg-pen';
                    return `<tr><td><b>${grp.name}</b><br><span style="color:#666">${eq.name}</span></td><td><span class="badge ${badge}">${c.status}</span></td><td style="color:#555">${c.status!=='OK'?'Falha':'Operacional'}</td></tr>`;
                }).join('');
                document.getElementById('rep-results').style.display='block';
                document.getElementById('print-date-info').innerText=`Data: ${date}`;
            }
        };

        const Auth={login:()=>{if(document.getElementById('login-user').value==='admin'){document.getElementById('login-screen').style.display='none';App.init();Nav.go('hero')}},logout:()=>{location.reload()}};
        
        // --- APP & NAV (UPDATED WITH DASHBOARD LOGIC) ---
        const App = {
            init: () => { 
                DB.init();
                App.updateDash();
            },
            toggleTheme: () => document.body.classList.toggle('dark-mode'),
            updateDash: () => {
                const today = new Date().toISOString().split('T')[0];
                const todaysChecks = DB.data.checks.filter(c => c.date === today);
                const fails = todaysChecks.filter(c => c.status === 'Erro').length;
                
                if(document.getElementById('dash-total')) {
                    document.getElementById('dash-total').innerText = todaysChecks.length;
                    document.getElementById('dash-fail').innerText = fails;
                }
            }
        };

        const Nav = {
            toggleSub: (id) => document.getElementById(id).classList.toggle('open'),
            go: (v) => {
                document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
                document.getElementById('view-' + v).classList.add('active');
                
                // Update Dashboard if going to Hero
                if(v === 'hero') App.updateDash();

                if (v.includes('admin-')) {
                    document.getElementById('sub-admin').classList.add('open');
                    if (v === 'admin-sites') AdmSites.render();
                    if (v === 'admin-types') AdmTypes.render();
                    if (v === 'admin-equips') AdmInst.init();
                }
                if (v.includes('checklist')) (v === 'checklist-cctv' ? ChecklistCCTV : ChecklistEq).init();
                if (v === 'reports') Reports.init();
            }
        };
    </script>
</body>
</html>